import React, { useState } from "react";
import { Box, Typography, Button } from '@mui/material';
import { useParams, useNavigate } from "react-router-dom";
import api from "../api/axios_token.jsx";
import { useNotification } from "../contexts/NotificationContext.jsx";
import Loading from "../Components/Loading.jsx";
import Logo from "../Images/logo3.png";
import Logo_light from "../Images/logo3_light.png";
import Logo_hacker from "../Images/logo_hacker.png";
import { useTheme } from "../contexts/theme/ThemeContext.jsx";

function PentestingTools() {
    const { domain } = useParams();
    const navigate = useNavigate();
    const { showNotification } = useNotification();
    const [loading, setLoading] = useState(false);
    const { theme } = useTheme();

    const startSipCalc = () => {
        console.log("sipcalc")
        navigate(`/${domain}/pentestingtools/sipcalc`)
    }

    const startNikto = async () => {
        console.log("nikto")
        try {
            setLoading(true)
            const response = await api.get(`/nikto?domain=${domain}`, {
                responseType: "blob",
            });

            const blob = new Blob([response.data], { type: "application/pdf" });
            const url = window.URL.createObjectURL(blob);

            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", `${domain}_nikto.pdf`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            setTimeout(() => window.URL.revokeObjectURL(url), 100);
            showNotification("Nikto Document is Downloaded. See your Downloads");
            setLoading(false)
        } catch (error) {
            console.error("Error downloading PDF:", error);
        }
    }

    return (
        <Box sx={{ color: theme.text }}>
            <Box sx={{
                display: "flex", flexDirection: "column", justifyContent: "center", gap: 3, p:2,pb:3, borderRadius:"20px", backgroundColor: theme.bg_behind_boxes
            }}>
                <Box>
                    <Typography sx={{ fontWeight: 'bold', fontSize: '2.5rem', fontFamily: 'Poppins, sans-serif' }}>
                        Pentesting Tools
                    </Typography>
                </Box>
                {
                    loading ? (
                        <Loading logo={theme.background === "#333333" ? Logo : theme.background === "#000000" ? Logo_hacker : Logo_light} size={80} animation="zoom" />
                    ) : (
                        <Box sx={{ display: "flex", gap: 3, width: "100%", flexDirection: { xs: "column", md: "row" } }}>
                            <Box sx={{
                                display: "flex", flexDirection: "column", backgroundColor: theme.box_bg, borderRadius: "12px",
                                border: "1px solid " + theme.box_bg_border,
                                padding: "20px",
                                flexGrow: "1",
                                textAlign: "center",
                                p: 3
                            }}>
                                <Typography sx={{ color: theme.secondary_text,fontWeight: 'bold', fontSize: '1.5rem', fontFamily: 'Poppins, sans-serif' }}>
                                    SipCalc
                                </Typography>
                                <Typography sx={{ fontSize: '1rem', fontFamily: 'Poppins, sans-serif', color: theme.box_info_color, textAlign: "left", mt: 3, mb: 4 }}>
                                    It is a command-line tool for performing subnet calculations and displaying IP address information for both IPv4 and IPv6 addresses
                                </Typography>
                                <Button
                                    variant="contained"
                                    onClick={startSipCalc}
                                    sx={{
                                        mt: "auto", alignSelf: "center", bgcolor: theme.button,
                                        px: 5,
                                        fontSize: "1rem",
                                        borderRadius: "30px",
                                        border: "1px solid " + theme.secondary_text,
                                        color: theme.secondary_text,
                                        textTransform: "none",
                                        "&:hover": {
                                            bgcolor: theme.button_hover,
                                            border: "1px solid " + theme.secondary_text,
                                        },
                                    }}>
                                    Start
                                </Button>
                            </Box>
                            <Box sx={{
                                display: "flex", flexDirection: "column", backgroundColor: theme.box_bg, borderRadius: "12px",
                                border: "1px solid " + theme.box_bg_border,
                                padding: "20px",
                                flexGrow: "1",
                                textAlign: "center",
                                p: 3
                            }}>
                                <Typography sx={{ color: theme.secondary_text,fontWeight: 'bold', fontSize: '1.5rem', fontFamily: 'Poppins, sans-serif' }}>
                                    Nikto
                                </Typography>
                                <Typography sx={{ fontSize: '1rem', fontFamily: 'Poppins, sans-serif', color: theme.box_info_color, textAlign: "left", mt: 3, mb: 2 }}>
                                    It is an open-source web server scanner that detects vulnerabilities by performing comprehensive tests on web servers
                                </Typography>
                                <Button
                                    variant="contained"
                                    onClick={startNikto}
                                    sx={{
                                        mt: "auto", alignSelf: "center", bgcolor: theme.button,
                                        px: 5,
                                        fontSize: "1rem",
                                        borderRadius: "30px",
                                        border: "1px solid " + theme.secondary_text,
                                        color: theme.secondary_text,
                                        textTransform: "none",
                                        "&:hover": {
                                            bgcolor: theme.button_hover,
                                            border: "1px solid " + theme.secondary_text,
                                        },
                                    }}>
                                    Start
                                </Button>
                            </Box>
                        </Box>
                    )
                }
            </Box>
        </Box>
    )
}

export default PentestingTools